#!/usr/bin/env ruby

source_path = File.dirname(__dir__)

$:.unshift(source_path)

editor = ENV['EDITOR'] || 'vi'

abort("You must supply a type ('hardware' or 'software').") unless ARGV[0] =~ /^(hardware|software)$/
abort("You must provide a name.") if ARGV[1].nil?

type = ARGV[0]
name = ARGV[1..-1].join(' ')
slug = name.downcase.gsub(/ /, '-')

paths = {}

%w[hardware software].each do |type|
  paths[type] = File.join(source_path, 'data', 'gear', type, "#{slug}.yml")
end

if File.exists?(paths['hardware']) || File.exists?(paths['software'])
  abort "Entry already exists for '#{slug}'."
else
  entry = <<ENTRY
---
name: #{name}
description: (description)
url: (url)
ENTRY

  File.open(paths[type], 'w') do |f|
    f.write(entry)
  end
end

`#{editor} #{paths[type]}`